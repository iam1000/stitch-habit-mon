# HabitMons with Supabase Auth & Database Plan

## 1. Overview
We will integrate **Supabase** to handle User Authentication (Sign Up, Login, Sign Out) and persistent data storage for habits and monster stats. This transitions the app from a client-side demo to a real full-stack application.

## 2. Tech Stack
- **Frontend**: React + Vite (Existing)
- **Backend/DB**: Supabase (PostgreSQL + Auth)
- **Library**: `@supabase/supabase-js`

## 3. Implementation Steps

### Phase 1: Setup & Connection
1.  **Install SDK**: `npm install @supabase/supabase-js`
2.  **Environment Variables**: Create `.env` to store `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`.
3.  **Supabase Client**: Create `src/supabaseClient.js` to initialize the connection.

### Phase 2: Authentication Context
1.  **Auth Provider**: Create `AuthContext.jsx` to wrap the app.
2.  **State Management**: Track `user` (null vs object) and `loading`.
3.  **Functions**: expose `signUp`, `signIn`, `signOut`.

### Phase 3: Database Schema (SQL)
*User needs to run this in Supabase Dashboard SQL Editor:*
```sql
-- 1. Profiles Table (Extends Auth)
create table profiles (
  id uuid references auth.users not null primary key,
  username text,
  avatar_url text,
  xp integer default 0,
  level integer default 1,
  monster_type text default 'blob' -- 'blob', 'dino', etc.
);

-- 2. Habits Table
create table habits (
  id bigint generated by default as identity primary key,
  user_id uuid references auth.users not null,
  title text not null,
  xp_reward integer default 10,
  completed boolean default false,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- 3. Row Level Security (RLS) Policies
alter table profiles enable row level security;
alter table habits enable row level security;

-- Only key requirement: Users can only see/edit their OWN data.
create policy "Users can view own profile" on profiles for select using (auth.uid() = id);
create policy "Users can update own profile" on profiles for update using (auth.uid() = id);
create policy "Users can crud own habits" on habits for all using (auth.uid() = user_id);
```

### Phase 4: UI Implementation
1.  **Login/Signup Page**: New route `/login`. Simple form.
2.  **Dashboard Integration**:
    *   Protect route (redirect to `/login` if no user).
    *   Fetch `habits` from DB instead of hardcoded state.
    *   Update `xp` in DB when tasks complete.
3.  **Navbar Update**: Show `Logout` if logged in.

## 4. Required User Action
The USER (Representative) needs to:
1.  Go to [database.new](https://database.new) (Supabase).
2.  Create a new project named "HabitMons".
3.  Copy the **Project URL** and **API Key (anon)**.
4.  Paste them into the `.env` file I will create.
5.  Run the SQL script provided above in the Supabase SQL Editor.

## 5. Next Immediate Actions from Assistant
1.  Install `@supabase/supabase-js`.
2.  Create `.env` template.
3.  Create `supabaseClient.js`.
4.  Create `AuthContext.jsx`.
