# 코드 관리 화면 (Code Management) 개발 가이드

## 1. 개요 및 목적
본 문서는 `stitch` 프로젝트의 공통 코드를 관리하는 화면의 최종 개발 사양을 정의합니다.
기존의 단순 리스트 형태에서 벗어나, **'투자 관리(Investment)' 화면의 프리미엄 UI/UX**를 차용하여 일관성을 확보하고, **검색 기능을 그룹과 상세 코드로 분리**하여 관리 편의성을 극대화하였습니다.

---

## 2. 데이터 아키텍처 (Google Sheets)

### 2.1. 시트 구조 (`CODES`)
모든 데이터는 구글 시트의 단일 시트(`CODES`)에서 `Flat Data` 형태로 관리됩니다. 트리 구조는 `group_code` 컬럼을 통해 논리적으로 연결됩니다.

| 컬럼명 (Key) | 설명 | 제약 사항 / 규칙 |
| :--- | :--- | :--- |
| **uuid** | 고유 식별자 | 시스템 자동 생성 (UUID v4) |
| **group_code** | 부모 그룹 ID | **'ROOT'**: 최상위 그룹(그룹 자체)<br>**특정 Code ID**: 해당 그룹에 소속된 하위 코드 |
| **code_id** | 코드 ID | **대문자 영문**. 그룹 식별 또는 상세 코드 값 |
| **code_name** | 코드명 | 화면에 표시되는 사용자 친화적 이름 (한글 등) |
| **order** | 정렬 순서 | 숫자. 화면 표시 순서를 결정 (오름차순) |
| **description** | 설명 | 코드에 대한 추가 설명 (Optional) |
| **use_yn** | 사용 여부 | 'Y' 또는 'N' (기본값 'Y') |

### 2.2. 계층 구조 논리
- **그룹(Group)**: `group_code`가 `'ROOT'`인 행들.
- **상세 코드(Code)**: `group_code`가 특정 그룹의 `code_id`인 행들.
- **가상 그룹 'TOP'**: DB에는 없지만, UI에서 '그룹 자체를 관리'하기 위해 사용하는 가상 최상위 개념.

---

## 3. UI/UX 구성안 (최종)

### 3.1. 레이아웃 컨셉 (Layout Concept)
- **전체 여백**: `p-6 lg:p-12`. 화면 가장자리에 충분한 여백을 두어 답답함을 해소하고 고급스러운 느낌 제공.
- **카드형 디자인**: 모든 섹션(검색바, 좌측 패널, 우측 패널)은 `White` (Dark mode: `Gray-800`) 배경과 둥근 모서리(`Rounded-xl`), 부드러운 그림자(`Shadow-sm`)를 가짐.
- **다크 모드 지원**: 모든 텍스트, 배경, 보더 색상은 다크 모드(`dark:`)를 완벽하게 지원.

### 3.2. 화면 구조 상세

#### [화면 레이아웃 목업]

```text
+-----------------------------------------------------------------------+
|  [Header]                                                             |
|  # 코드 관리                                                          |
|  시스템에서 사용하는 공통 코드를 그룹별로 관리하고 통제합니다.        |
+-----------------------------------------------------------------------+
|                                                                       |
|  [Top Bar: 그룹 검색]                                                 |
|  +---------------------------------------------------------------+    |
|  | [Icon] 그룹코드 검색 : [   그룹명 또는 ID 입력...   ] [X]     |    |
|  |                                          전체 그룹: 12 개     |    |
|  +---------------------------------------------------------------+    |
|                                                                       |
+-----------------------------------------------------------------------+
|  [Main Content: Split View]                                           |
|                                                                       |
|  +-----------------------+   +-------------------------------------+  |
|  | [Left Panel: Groups]  |   | [Right Panel: Detail Codes]         |  |
|  |                       |   |                                     |  |
|  | [Icon] 그룹 목록      |   | [Icon] 배송관리 (DLV)               |  |
|  | --------------------- |   |        그룹 ID: DELIVERY            |  |
|  |                       |   | ----------------------------------- |  |
|  |  [Icon] TOP (그룹관리)|   |                                     |  |
|  |                       |   | [Search: 하위 코드 검색...    ]     |  |
|  | --------------------- |   |                                     |  |
|  |                       |   | +----+-------+-------+------+-----+ |  |
|  |  [Icon] 배송관리      |   | | No | ID    | Name  | Ord  | Use | |  |
|  |         DELIVERY      |   | +----+-------+-------+------+-----+ |  |
|  |                       |   | | 1  | FREE  | 무료  | 1    | [Y] | |  |
|  |  [Icon] 주문상태      |   | | 2  | PAID  | 착불  | 2    | [Y] | |  |
|  |         ORDER_STS     |   | +----+-------+-------+------+-----+ |  |
|  |                       |   | | +  | [ID]  | [Name]| [1]  | [Y] | |  |
|  |  ...                  |   | +----+-------+-------+------+-----+ |  |
|  +-----------------------+   +-------------------------------------+  |
+-----------------------------------------------------------------------+
```

#### A. 헤더 영역 (Header)
- **타이틀**: "코드 관리" (3xl, Bold)
- **설명**: 시스템 공통 코드 통제 및 관리 목적 명시.

#### B. 상단 필터 바 (Top Bar) - **[그룹 검색]**
- **위치**: 헤더 바로 아래 가로로 긴 카드 형태.
- **기능**: **좌측 그룹 목록**을 필터링하는 전용 검색창.
- **구성**:
    - 라벨: "그룹코드 검색"
    - Input: 그룹명 또는 그룹ID 검색.
    - 통계: 전체 그룹 개수 표시.

#### C. 메인 컨텐츠 영역 (Split View)
좌측(1) : 우측(3) 비율로 분할된 2개의 패널.

**1) 좌측 패널: 그룹 목록 (Group List)**
- **역할**: 관리할 대분류(그룹)를 선택하는 내비게이션 역할.
- **구성**:
    - **TOP (그룹 관리)**: 최상단 고정. 선택 시 우측 패널에서 새로운 그룹을 생성하거나 기존 그룹 정보를 수정할 수 있음.
    - **그룹 리스트**: `group_code='ROOT'`인 항목들. (상단 검색바에 의해 필터링됨)
    - **인터랙션**: 클릭 시 `selectedGroup` 상태 변경 -> 우측 패널 갱신.

**2) 우측 패널: 상세 코드 관리 (Detail Management)**
- **역할**: 선택된 그룹 내의 하위 코드를 조회, 추가, 수정, 삭제하는 작업 공간.
- **Header**:
    - 좌측: 선택된 그룹명 및 ID 표시.
    - 우측: **[하위 코드 검색]** Input (Local Search).
- **Table**:
    - 컬럼: No, 코드ID, 코드명, 정렬, 설명, 사용, 관리.
    - **조회 모드**: 텍스트 표시.
    - **수정 모드**: 해당 행이 Input Field로 전환(Inline Editing).
- **Footer (Row)**:
    - **신규 추가 행**: 테이블 최하단에 항상 노출(검색 중일 때는 숨김).
    - `Enter` 키로 빠른 연속 등록 지원.

---

## 4. 기능 명세 및 로직 (Logic)

### 4.1. 검색 로직 (Search Logic) - **이원화 전략**
오늘 작업을 통해 통합 검색에서 **분리형 검색**으로 최종 변경되었습니다.

| 검색 유형 | 대상 데이터 | 위치 | 동작 |
| :--- | :--- | :--- | :--- |
| **그룹 검색** | `group_code === 'ROOT'` | 상단 바 | 입력어 포함 시 **좌측 목록**만 필터링. |
| **하위 코드 검색** | `group_code === selectedGroup.code_id` | 우측 패널 헤더 | 입력어 포함 시 **우측 테이블**만 필터링. |

> **UX 의도**: 사용자가 "어떤 그룹"의 "어떤 코드"를 찾는지 맥락을 유지하면서 검색할 수 있도록 함.

### 4.2. CRUD 프로세스
1.  **추가 (Create)**
    - `UseYn` 기본값 'Y', `Order` 자동 부여(Max + 1).
    - 그룹 추가: `TOP` 선택 상태에서 추가 시 -> `group_code='ROOT'`로 저장됨.
    - 코드 추가: 특정 그룹 선택 상태에서 추가 시 -> `group_code='선택된그룹ID'`로 저장됨.
2.  **수정 (Update)**
    - 인라인 수정 방식. 수정 아이콘 클릭 시 해당 행만 `input`으로 변경.
    - 저장 또는 취소 가능.
3.  **삭제 (Delete)**
    - **Validation**: 하위 코드가 있는 그룹은 삭제 불가 알림 ("하위 코드를 먼저 삭제하세요").
    - 삭제 후 낙관적 업데이트(Optimistic Update)로 UI 즉시 반영.

---

## 5. 기술 스택 및 파일 정보

- **대상 파일**: `src/CodeManagement.jsx`
- **주요 라이브러리**:
    - `lucide-react`: 직관적인 아이콘 (Folder, Tag, Search, Plus, Trash2 등).
    - `Tailwind CSS`: 전체 스타일링 및 다크 모드 처리.
- **API 연동**:
    - Netlify Functions (Serverless)를 통해 Google Sheets API와 통신.
    - `sheets-data`, `sheets-add`, `sheets-update`, `sheets-delete`.

---

## 6. 결론
이 가이드는 **사용자 경험(UX)**을 최우선으로 고려하여 재설계된 코드 관리 화면의 표준입니다. 특히 **검색 기능의 분리**와 **카드형 UI 도입**은 데이터의 계층 구조를 명확히 하고 관리의 효율성을 높이는 핵심 변경 사항입니다.
