# ë¡œê·¸ì¸ ì¸ì¦ ë° ì„¸ì…˜ ì²´í¬ êµ¬í˜„ ê°€ì´ë“œ ğŸ”’

ë³¸ ë¬¸ì„œëŠ” **React**ì™€ **Supabase**ë¥¼ í™œìš©í•˜ì—¬ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³ , **React Router**ì™€ **Context API**ë¥¼ í†µí•´ ì„¸ì…˜ì„ ê´€ë¦¬í•˜ë©° ë¹„ì¸ê°€ëœ ì ‘ê·¼ì„ ì°¨ë‹¨í•˜ëŠ” ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤. ì´ ê°€ì´ë“œë¥¼ ë”°ë¥´ë©´ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ì—ì„œë„ ë™ì¼í•œ ë³´ì•ˆ êµ¬ì¡°ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

1.  **Supabase Auth**: ë°±ì—”ë“œ ì¸ì¦ ì„œë¹„ìŠ¤ (ë¡œê·¸ì¸, íšŒì›ê°€ì…, ì„¸ì…˜ ìœ ì§€).
2.  **AuthContext (React Context)**: ì•± ì „ì—­ì— ë¡œê·¸ì¸ ìƒíƒœ(`user`)ì™€ ë¡œë”© ìƒíƒœ(`loading`)ë¥¼ ê³µê¸‰.
3.  **ProtectedRoute (React Component)**: ë¼ìš°íŠ¸ ì§„ì… ì‹œ ì¸ì¦ ìƒíƒœë¥¼ ê²€ì‚¬í•˜ì—¬ ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìë¥¼ ì°¨ë‹¨.
4.  **React Router (App.jsx)**: ê³µê°œ ë¼ìš°íŠ¸ì™€ ë³´í˜¸ëœ ë¼ìš°íŠ¸ë¥¼ ë¶„ë¦¬í•˜ì—¬ êµ¬ì¡°í™”.

---

## ğŸ“‹ 1. ì‚¬ì „ ì¤€ë¹„ (Environment Setup)

Supabase í”„ë¡œì íŠ¸ ìƒì„± í›„, `.env` íŒŒì¼ì— API í‚¤ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

**`.env` íŒŒì¼ ì˜ˆì‹œ:**
```env
VITE_SUPABASE_URL=YOUR_SUPABASE_PROJECT_URL
VITE_SUPABASE_ANON_KEY=YOUR_SUPABASE_ANON_KEY
```

---

## ğŸ› ï¸ 2. Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” (`src/supabaseClient.js`)

í™˜ê²½ ë³€ìˆ˜ë¥¼ ì´ìš©í•´ Supabase í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  export í•©ë‹ˆë‹¤. ì´ ì¸ìŠ¤í„´ìŠ¤ëŠ” ì•± ì „ì²´ì—ì„œ ê³µìœ ë©ë‹ˆë‹¤.

```javascript
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
```

---

## ğŸ§  3. ì¸ì¦ ìƒíƒœ ê´€ë¦¬ (`src/AuthContext.jsx`)

ì•±ì´ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ ë¡œê·¸ì¸ ì„¸ì…˜ì„ ì§€ì†ì ìœ¼ë¡œ ê°ì‹œí•˜ê³  ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ëª¨ë“ˆì…ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥:**
*   `useEffect`: ì•± ì‹œì‘ ì‹œ í˜„ì¬ ì„¸ì…˜ í™•ì¸ (`getSession`).
*   `onAuthStateChange`: ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ ì‹¤ì‹œê°„ ê°ì§€.
*   `loading`: ì„¸ì…˜ í™•ì¸ì´ ì™„ë£Œë˜ê¸° ì „ê¹Œì§€ í™”ë©´ ë Œë”ë§ì„ ë³´ë¥˜í•˜ê¸° ìœ„í•œ ìƒíƒœ.

```javascript
import React, { createContext, useState, useEffect, useContext } from 'react';
import { supabase } from './supabaseClient';

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
    const [user, setUser] = useState(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        // 1. ì´ˆê¸° ë¡œë“œ ì‹œ ì„¸ì…˜ í™•ì¸
        const getSession = async () => {
            const { data: { session } } = await supabase.auth.getSession();
            setUser(session?.user ?? null);
            setLoading(false);
        };
        getSession();

        // 2. ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ ê°ì§€ (ì‹¤ì‹œê°„)
        const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
            setUser(session?.user ?? null);
            setLoading(false);
        });

        return () => subscription.unsubscribe();
    }, []);

    const signIn = (email, password) => supabase.auth.signInWithPassword({ email, password });
    const signOut = () => supabase.auth.signOut();

    return (
        <AuthContext.Provider value={{ signIn, signOut, user, loading }}>
            {/* ì„¸ì…˜ í™•ì¸ ì¤‘ì—ëŠ” ì•„ë¬´ê²ƒë„ ë Œë”ë§í•˜ì§€ ì•ŠìŒ (ê¹œë¹¡ì„ ë°©ì§€) */}
            {!loading && children}
        </AuthContext.Provider>
    );
};

export const useAuth = () => useContext(AuthContext);
```

---

## ğŸšª 4. ë¡œê·¸ì¸ í™”ë©´ êµ¬í˜„ (`src/Login.jsx`)

ì‚¬ìš©ì ì…ë ¥ì„ ë°›ì•„ Supabase ì¸ì¦ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

```javascript
import { useAuth } from './AuthContext';
import { useNavigate } from 'react-router-dom';

const Login = () => {
    const { signIn } = useAuth();
    const navigate = useNavigate();
    // ... input state ê´€ë¦¬ ...

    const handleLogin = async (e) => {
        e.preventDefault();
        try {
            const { error } = await signIn(email, password);
            if (error) throw error;
            // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
            navigate('/dashboard');
        } catch (err) {
            alert(err.message);
        }
    };
    // ... UI ë Œë”ë§ ...
};
```

---

## ğŸ›¡ï¸ 5. ë³´ì•ˆ ë¼ìš°íŠ¸ (ê²€ë¬¸ì†Œ) êµ¬í˜„ (`src/ProtectedRoute.jsx`)

ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ URLì„ ì§ì ‘ ì…ë ¥í•˜ì—¬ ë‚´ë¶€ í˜ì´ì§€ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë§‰ëŠ” ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

```javascript
import React from 'react';
import { Navigate, Outlet } from 'react-router-dom';
import { useAuth } from './AuthContext';

const ProtectedRoute = () => {
    const { user, loading } = useAuth();

    // ë¡œë”© ì¤‘ì¼ ë•Œ ë¹ˆ í™”ë©´ (AuthContextì—ì„œ ì²˜ë¦¬í•˜ì§€ë§Œ, ì´ì¤‘ ì•ˆì „ì¥ì¹˜)
    if (loading) return <div />;

    // ìœ ì € ì •ë³´ê°€ ìˆìœ¼ë©´ ìì‹ ì»´í¬ë„ŒíŠ¸(Outlet) ë Œë”ë§, ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
    return user ? <Outlet /> : <Navigate to="/login" replace />;
};

export default ProtectedRoute;
```

---

## ğŸ”— 6. ë¼ìš°í„° í†µí•© ì„¤ì • (`src/App.jsx`)

**ê³µê°œ ë¼ìš°íŠ¸**ì™€ **ë³´í˜¸ëœ ë¼ìš°íŠ¸**ë¥¼ ëª…í™•íˆ ë¶„ë¦¬í•˜ì—¬ `ProtectedRoute`ë¥¼ ì ìš©í•©ë‹ˆë‹¤.

```javascript
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import { AuthProvider } from './AuthContext';
import ProtectedRoute from './ProtectedRoute';
// ... ì»´í¬ë„ŒíŠ¸ ì„í¬íŠ¸ ...

function App() {
  return (
    <AuthProvider>
      <Router>
        <Routes>
          {/* [ê³µê°œ êµ¬ì—­] ëˆ„êµ¬ë‚˜ ì ‘ê·¼ ê°€ëŠ¥ */}
          <Route path="/login" element={<Login />} />
          <Route path="/" element={<LandingPage />} />

          {/* [ë³´ì•ˆ êµ¬ì—­] ğŸ”’ ë°˜ë“œì‹œ ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ë“¤ */}
          {/* ProtectedRouteë¡œ ê°ì‹¸ì„œ ë‚´ë¶€ Routeë“¤ì„ ë³´í˜¸ */}
          <Route element={<ProtectedRoute />}>
             <Route element={<MainLayout />}>
                <Route path="/dashboard" element={<Dashboard />} />
                <Route path="/investment" element={<Investment />} />
                <Route path="/codes" element={<CodeManagement />} />
                {/* ... ê¸°íƒ€ ë©”ë‰´ë“¤ ... */}
             </Route>
          </Route>

        </Routes>
      </Router>
    </AuthProvider>
  );
}
```

---

## ğŸ”„ ì „ì²´ ë™ì‘ íë¦„ ìš”ì•½

1.  **ì•± ì‹¤í–‰:** `AuthProvider`ê°€ `Supabase` ì„¸ì…˜ì„ ì²´í¬í•©ë‹ˆë‹¤. (`user` í™•ì¸)
2.  **ë¡œê·¸ì¸ ì „:** `user`ê°€ ì—†ëŠ” ìƒíƒœì—ì„œ `/investment` ì ‘ê·¼ ì‹œë„ â†’ `ProtectedRoute`ê°€ ê°ì§€ â†’ `/login`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸.
3.  **ë¡œê·¸ì¸:** ì‚¬ìš©ìê°€ ì´ë©”ì¼/ë¹„ë²ˆ ì…ë ¥ â†’ `supabase.auth.signInWithPassword` í˜¸ì¶œ â†’ ì„±ê³µ ì‹œ ì„¸ì…˜ ìƒì„± â†’ `AuthContext`ì˜ `user` ìƒíƒœ ì—…ë°ì´íŠ¸.
4.  **ë¡œê·¸ì¸ í›„:** `user`ê°€ ìˆëŠ” ìƒíƒœì—ì„œ `/investment` ì ‘ê·¼ ì‹œë„ â†’ `ProtectedRoute`ê°€ "í†µê³¼" íŒì • â†’ `Outlet`(`MainLayout` -> `Investment`) ë Œë”ë§.
5.  **ë¡œê·¸ì•„ì›ƒ:** `supabase.auth.signOut` í˜¸ì¶œ â†’ ì„¸ì…˜ ì‚­ì œ â†’ `AuthContext` ê°ì§€ â†’ `user` ìƒíƒœ `null`ë¡œ ë³€ê²½ â†’ í˜„ì¬ í™”ë©´ì´ ë³´í˜¸ëœ ë¼ìš°íŠ¸ë¼ë©´ ì¦‰ì‹œ `/login`ìœ¼ë¡œ íŠ•ê²¨ë‚˜ê°.


ì´ ê°€ì´ë“œë¥¼ ë”°ë¼ êµ¬í˜„í•˜ë©´ ì•ˆì „í•˜ê³  ê²¬ê³ í•œ ì¸ì¦ ê¸°ë°˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## â³ 7. ë¡œê·¸ì¸ ì„¸ì…˜ íƒ€ì„ ê´€ë¦¬ (Session Time Management)

SupabaseëŠ” **JWT(JSON Web Token)** ê¸°ë°˜ì˜ ì¸ì¦ì„ ì‚¬ìš©í•˜ë©°, í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í† í° ê°±ì‹ ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

### 1. ê¸°ë³¸ ë™ì‘ ì›ë¦¬
*   **Access Token (ì•¡ì„¸ìŠ¤ í† í°)**: ìˆ˜ëª…ì´ ì§§ìŒ (ê¸°ë³¸ 1ì‹œê°„). API í˜¸ì¶œ ì‹œ ì‚¬ìš©ë©ë‹ˆë‹¤.
*   **Refresh Token (ë¦¬í”„ë ˆì‹œ í† í°)**: ìˆ˜ëª…ì´ ê¸º (ì„¤ì • ê°€ëŠ¥). ì•¡ì„¸ìŠ¤ í† í°ì´ ë§Œë£Œë˜ë©´, ì´ í† í°ì„ ì‚¬ìš©í•´ ëª°ë˜ ìƒˆ ì•¡ì„¸ìŠ¤ í† í°ì„ ë°›ì•„ì˜µë‹ˆë‹¤.
*   **ìë™ ê°±ì‹ **: `supabase-js` ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì•±ì´ ì¼œì ¸ ìˆëŠ” ë™ì•ˆ ë°±ê·¸ë¼ìš´ë“œì—ì„œ í† í°ì„ ìë™ìœ¼ë¡œ ê°±ì‹ í•©ë‹ˆë‹¤. (ê°œë°œìê°€ ë³„ë„ ì½”ë“œë¥¼ ì§¤ í•„ìš”ê°€ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.)

### 2. ì„¸ì…˜ ë§Œë£Œ ì‹œê°„ ê¸°ë³¸ê°’ (Defaults)
ì‚¬ìš©ìë‹˜ì˜ ì„¤ì • í™”ë©´(`User Sessions`)ì„ ë¶„ì„í•œ ê²°ê³¼, í˜„ì¬ ê¸°ë³¸ê°’ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

*   **ë¡œê·¸ì¸ ìœ ì§€ ì‹œê°„**: **ë¬´ì œí•œ (Never)**
    *   ì„¤ì •ê°’: `Time-box user sessions: 0`
    *   ì˜ë¯¸: ì‚¬ìš©ìê°€ **ì§ì ‘ ë¡œê·¸ì•„ì›ƒí•˜ì§€ ì•ŠëŠ” í•œ**, ë¸Œë¼ìš°ì €ë¥¼ ë‹«ì•˜ë‹¤ ì—´ì–´ë„ ë¡œê·¸ì¸ ìƒíƒœê°€ ì˜êµ¬ì ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.
    *   ì°¸ê³ : ë‚´ë¶€ì ìœ¼ë¡œ Access Token(1ì‹œê°„)ì€ ìë™ìœ¼ë¡œ ê³„ì† ê°±ì‹ ë©ë‹ˆë‹¤.

*   **ë³€ê²½ ë°©ë²•**: ë¡œê·¸ì¸ ì‹œê°„ì„ ì œí•œ(ì˜ˆ: 1ì‹œê°„ ë’¤ ê°•ì œ ë¡œê·¸ì•„ì›ƒ)í•˜ë ¤ë©´, ìŠ¤í¬ë¦°ìƒ·ì— ìˆë˜ **`Inactivity timeout`** ê°’ì„ ë³€ê²½í•˜ì‹œë©´ ë©ë‹ˆë‹¤. (ë‹¨, Supabase Pro í”Œëœ ì´ìƒì—ì„œë§Œ ë™ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)

### 3. ê°•ì œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
ì„¸ì…˜ì´ ë§Œë£Œë˜ê±°ë‚˜(ë¦¬í”„ë ˆì‹œ í† í°ê¹Œì§€ ë§Œë£Œ), ì‚¬ìš©ìê°€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì—¬ í† í°ì´ ë¬´íš¨í™”ë  ê²½ìš°, `AuthContext`ì˜ `onAuthStateChange`ê°€ `SIGNED_OUT` ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•©ë‹ˆë‹¤.

```javascript
// AuthContext.jsx ë‚´ë¶€
supabase.auth.onAuthStateChange((event, session) => {
    if (event === 'SIGNED_OUT') {
        // ì„¸ì…˜ ë§Œë£Œ ë˜ëŠ” ë¡œê·¸ì•„ì›ƒ ì‹œ
        setUser(null);
        // ProtectedRouteì— ì˜í•´ ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ë¨
    }
});
```
ìœ„ì™€ ê°™ì´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ì„¸ì…˜ ë§Œë£Œ ì‹œ ì•±ì€ ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì „í™˜ë©ë‹ˆë‹¤.
